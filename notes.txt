# 12-21-25

## goal 1: get a txt file of colo somatic svs with 0/0 gt

```
# colo829sv column is the sample name
# for some reason you can query for this using GT=0/0
bcftools query -f '%ID\n' --include 'GT="0/0"' colo829_benchmark_grch38.vcf
```
- see /data/jake/stix-lr/results/2025_12-colo-filtered/run.sh
  for producing a filtered vcf where GT=0/0 is excluded
  ```
  bcftools view --exclude 'GT="0/0"' "$input_somatic" -o "$output_somatic" -O v
  ```
  - this script also outputs a txt file of ids with 0/0 GT

## goal 2: remove somatic svs from merge colo file

- approach 1 see if any IDs from somatic file are in merge
```
l /data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_merge_grch38.vcf
```
- no, 

- approach 2: try querying regions from somatic vcf

```
bcftools query -f '%CHROM:%POS-%INFO/END\n' \
  /data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_benchmark_grch38.vcf
```
- good but interchromasomal svs are problematic
```
chr9:28034301-28157694
chr10:7090915-N[chr19:17286830[
chr10:7592410-N]chr18:9868619]
chr10:81882050-82067910
chr10:87940543-87952372
```
- solution: exclude interchromsomal somatic svs from analysis

```
bcftools query -f '%ID\n' --include 'INFO/SVTYPE="BND"' "$input_somatic" > "$output_somatic_bnd_ids"
```

- finally,
  - exclude get regions of non-BND somatic SVs and find corresponding IDs in merge file

```

## goal 3: verify stix lr colo results

# all done. elapsed time: 211306 seconds.

## goal 4: get stix lr colo results (un)-filtered


- see /data/jake/stix-lr/results/2025_12-colo-stix_lr/run.sh
for combining stix lr results across contigs
  - final outputs
    - colo_germline.min_read_1.concat.sort.vcf
    - colo_germline.min_read_5.concat.sort.vcf

- now apply GT filtering to somatic

- see /data/jake/stix-lr/results/2025_12-colo-stix_lr-filtered/run.sh
for applying somatic/germline filters and getting the sample counts

## goal 5: get colo svafotate filtered results

- done. see /data/jake/stix-lr/results/2025_12-colo-svafotate-filtered/run.sh

## goal 6: pack stixlr and svafotate colo filtered results into tar

- see /data/jake/stix-lr/results/2025_12-colo_all-filtered/run.sh
colo_filtered_stix_lr_svafotate_results.tar.gz


## summary




# 12-19-25

## goal 1: estimate remaining time for somatic colo stix lr

- count germline v somatic
``` 
# somatic
cd /data/jake/stix-lr/data/2025_11-colo_sv_calls
grep -v "^#" colo829_benchmark_grch38.vcf | grep -iv bnd | wc -l
# 50
# germline
grep -v "^#" colo829_merge_grch38.vcf | grep -iv bnd | wc -l
# 30301

## goal 2:  send ryan in progress min_read_1 colo germline

```
cd /data/jake/stix-lr/results/2025_12-colo-stix_lr
mapfile -t fmr1 < <(ls *.min_read_1.vcf | grep -v "somatic")
mkdir tmp
cp  ${fmr1[@]} tmp
cd tmp
# trim last line bc in progress leads to errors
for file in "${fmr1[@]}"; do
  head -n -1 "$file" > "${file}.tmp" && mv "${file}.tmp" $file
done

# concat regions
bcftools concat $(echo ${fmr1[@]}) -O v -o colo_germline.min_read_1.concat.progress.vcf
# sort
bcftools sort -o colo_germline.min_read_1.concat.progress.sort.vcf colo_germline.min_read_1.concat.progress.vcf
# bgzip
bgzip -c colo_germline.min_read_1.concat.progress.sort.vcf \
  > colo_germline.min_read_1.concat.progress.sort.vcf.gz
# get tsv of sample depth
../../../src/stixlr_vcfout2svid_cample_count.py \
  --input colo_germline.min_read_1.concat.progress.sort.vcf \
  --output colo_germline.min_read_1.concat.progress.tsv \
  --add_header

```

## summary
- sent stix lr colo germline progress to ryan
  - see code for reference on concatting
## next steps
- from final results files,
  - remove somatic svs with 0/0 genotype
    -bcftools exclude by gt info
  - remove somatics svs in germline/merge output
    -bcftools exclude by region/id/...?
- regenerate the array tsvs from filtered result vcfs
  - send over slack
- check status of stix lr colo minread5/1
- convert cosmic tsv -> vcf
  - run cosmic
    - svafotate
    - stix lr

# 12-18-25
## goal 1: verify that stix -B and -f produce output correctly
- that is, sharding and vcf are compatible
    - yes
    - proof: STIX_ZERO=284;STIX_ONE=824
## goal 2: svafotate for hg002 with variable overlap

```
cd /data/jake/stix-lr/src
./svafotate-hg002_cmrg.py \
  --input ../data/2025_12-hg002-cmrg/HG002_GRCh38_difficult_medical_gene_SV_benchmark_v0.01_trusted_SVTYPE.addID.svafotate.vcf \
  --outdir ../results/2025_12-hg002_cmrg-svafotate \
  --bed $SVAFTOTATE_BED \
  --env_name svafotate-env

## goal 3: try splitting vcf and merging

```
cd /data/jake/tmp
mkdir vcf_split_merge && cd vcf_split_merge
cp /data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_merge_grch38.vcf \
bgzip -c colo829_merge_grch38.vcf > colo829_merge_grch38.vcf.gz
vcf_all=colo829_merge_grch38.vcf.gz
tabix -p vcf $vcf_all
# chr1
bcftools view -r chr1 -O v -o chr1.$vcf_all $vcf_all
# chr2
bcftools view -r chr2 -O v -o chr2.$vcf_all $vcf_all
```
works, now try merge
```
bcftools concat chr1.$vcf_all chr2.$vcf_all -O v -o merged1_2.$vcf_all
```

## goal 4: hg002 stix lr vcf to popfreq tsv

```
# 1 min read
./stixlr_vcfout2svid_cample_count.py \
  --input ../results/2025_12-hg002_cmrg-stix_lr/hg002_cmrg.stix_lr.min_read_1.vcf \
  --output ../results/2025_12-hg002_cmrg-stix_lr/hg002_cmrg.stix_lr.min_read_1.popfreq.tsv \
  --add_header
# 5 min read
./stixlr_vcfout2svid_cample_count.py \
  --input ../results/2025_12-hg002_cmrg-stix_lr/hg002_cmrg.stix_lr.min_read_5.vcf \
  --output ../results/2025_12-hg002_cmrg-stix_lr/hg002_cmrg.stix_lr.min_read_5.popfreq.tsv \
  --add_header
```

## goal 5: tar archive hg002 stix lr and svafotate results

```
./tar_hg002_results.sh /data/jake/tmp
```

## goal 6: split colo germline vcf by contig

- ex code to get uniq contigs
```
grep "^##contig" /data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_merge_grch38.vcf | \
  cut -d ',' -f 1 | cut -d '=' -f 3 
```

```
outdir=../results/2025_12-colo_germline_split
input=../data/2025_11-colo_sv_calls/colo829_merge_grch38.vcf
tmp=/data/jake/tmp
prefix=colo_germline
./split_colo_germline_by_contig.sh \
  --input $input \
  --outdir $outdir \
  --tempdir $tmp \
  --prefix $prefix \
  --vcf_needs_bgz
```

## goal 7: parallelize colo stix lr by contig

```
./stix_lr-colo-parallel_contig.sh \
  --indir ../results/2025_12-colo_germline_split \
  --outdir ../results/2025_12-colo-stix_lr \
  --tempdir /data/jake/tmp \
  --index /data/jake/stix-lr-grch38
```

## goal 8: send ryan somatic colo stix lr
```
in1=/data/jake/stix-lr/results/2025_12-colo-stix_lr/colo_somatic.stix_lr.min_read_1.vcf
out1=/data/jake/stix-lr/results/2025_12-colo-stix_lr/colo_somatic.stix_lr.min_read_1.svid_sample_count.tsv
cd /data/jake/stix-lr/src
./stixlr_vcfout2svid_cample_count.py \
  --input $in1 \
  --output $out1 \
  --add_header
```

```
# from local
rsync -vaP mcclintock:/data/jake/stix-lr/results/2025_12-colo-stix_lr/colo_somatic.stix_lr.min_read_1.svid_sample_count.tsv \
  .
rsync -vaP mcclintock:/data/jake/stix-lr/results/2025_12-colo-stix_lr/colo_somatic.stix_lr.min_read_5.svid_sample_count.tsv \
  .
```


## summary
- split and parallelized stix lr colo germline
- finished stix lr and svafotate hg002 results
  - see results/2025_12-hg002_all/hg002_cmrg_stix_lr_svafotate_results.tar.gz
- verified that stix works with shardfile and vcf input
  - STIX_ONE and STIX_ZERO were correct in the output vcfs

# 12-17-25
# goal 1: run stix lr on colo
- test out stix built-in sharding utility
- here's claude's summary of how sharding (-B) works

-B takes a sharding file as an argument
  - a 2 col tsv of giggle_path | stixdb_path
  - lines are shards

- let's do a small test
```
# make 2 stix dbs
cd /data/jake/genefusion/data/dna_pad/headneck/shards
cd shard_0
echo "Alt_file" > headneck.ped
ls beds | sort >> headneck.ped
stix -i headneck_sort_b -p headneck.ped -d headneck.ped.db
cd ../shard_1
echo "Alt_file" > headneck.ped
ls beds | sort >> headneck.ped
stix -i headneck_sort_b -p headneck.ped -d headneck.ped.db
# make shard file
cd ../
printf "shard_0/headneck_sort_b\tshard_0/headneck.ped.db\nshard_1/headneck_sort_b\tshard_1/headneck.ped.db\n" \
  > shardfile.test
```
- try querying with shard file
```
stix -t DEL -l 1:9996-9996 -r 1:10016-10112 \
  -B shardfile.test
  $ stix -t DEL -l 1:9996-9996 -r 1:10016-10112   -B shardfile.test
#stix_run_giggle_query: left:1 9996 9996 right:1 10016 10112
#Could not open file 'beds/FI13317.excord.bed.gz'
#stix: Could not open beds/FI13317.excord.bed.gz.
```
- lookslike all shards need to be in same curdir
- ah tricky, because the gigle index is sensitive to paths
  - so, you need to make sure the dir with bed files has 
  unique names per shard...
- let's try on 1kg/LR
```
# make shardfile
tmp=/data/jake/tmp
cd /data/stix/LR/2024-09-07
ls | grep giggle_idx > $tmp/x
ls | grep stix_idx > $tmp/y
paste $tmp/x $tmp/y > $tmp/z
head $tmp/z
```
- test query
- from HG00171.sorted.1kgvienna.t2t.bed.gz
  - in /data/stix/LR/2024-09-07/02.1.data_shard00
```
tmp=/data/jake/tmp
left="1:1064-6995"
right="1:2361-7024"
cd /data/stix/LR/2024-09-05
# from sample HG00110.1000g.ont.sorted.bed.gz
# 1       10000   10379   1       1       10433   35120   1       1
left=1:10000-10379
right=1:10433-35120
stix -t DEL -l $left -r $right -s 500 -c 5 \
  -i 03.1.giggle_idx_00 -d 03.1.stix_idx_00.db
# stix -t DEL -l $left -r $right -B $tmp/z -s 500 -c 1 -T 1
```

- seems like I need write access to giggle subdirs?

```
# working test example
singularity /data/jake/genefusion/data/dna_pad/headneck/shards/shard_0 
$ stix -t DEL -l 1:10000-20000 -r 1:11000-20000 -i headneck_sort_b -d headneck.ped.db -s 500
stix_run_giggle_query: left:1 10000 20000       right:1 11000 20000
Total   0:1     0:4     0:0:0   0:0:0:0
Giggle_File_Id  Alt_file        Pairend Split
0       FI13317.excord.bed.gz   59      0
1       FI22814.excord.bed.gz   100     0
2       FI34579.excord.bed.gz   67      0
3       FI9326.excord.bed.gz    60      0
singularity /data/jake/genefusion/data/dna_pad/headneck/shards/shard_0 
$ ls 
beds  headneck.ped  headneck.ped.db  headneck_sort_b
singularity /data/jake/genefusion/data/dna_pad/headneck/shards/shard_0 
$ ls -lsh headneck_sort_b/
total 5.7G
222M -rw-rw----+ 1 jakr3437 nogroup 222M Dec  5 15:10 cache.0.dat
7.6M -rw-rw----+ 1 jakr3437 nogroup 7.6M Dec 17 12:46 cache.0.idx
```

```
# failing example on LR index
singularity /data/stix/LR/2024-09-05 
$ stix -t DEL -l $left -r $right -s 500 -c 5 \
>   -i 03.1.giggle_idx_00 -d 03.1.stix_idx_00.db
stix_run_giggle_query: left:1 10000 10379       right:1 10433 35120
stix: Could not open index_file '03.1.giggle_idx_00/cache.0.idx'.: Permission denied
singularity /data/stix/LR/2024-09-05 
$ ls -lsh 03.1.giggle_idx_00 | head
total 22G
 4.9G -rwxr-x---. 1 nobody nogroup  4.9G Sep 16  2024 cache.0.dat
 3.8M -rwxr-x---. 1 nobody nogroup  3.8M Sep 24 13:37 cache.0.idx
 876M -rwxr-x---. 1 nobody nogroup  876M Sep 16  2024 cache.1.dat
 1.9M -rwxr-x---. 1 nobody nogroup  1.9M Sep 24 13:37 cache.1.idx
  12K -rwxr-x---. 1 nobody nogroup  9.1K Sep 16  2024 cache.10.dat
 4.0K -rwxr-x---. 1 nobody nogroup   498 Sep 24 13:37 cache.10.idx
 4.0K -rwxr-x---. 1 nobody nogroup   270 Sep 16  2024 cache.100.dat
 4.0K -rwxr-x---. 1 nobody nogroup   138 Sep 24 13:37 cache.100.idx
 4.0K -rwxr-x---. 1 nobody nogroup   204 Sep 16  2024 cache.101.dat
```

- test copying a shard of index

```
dout=/data/jake/stix-lr-grch38
cp -r 02.1.data.00 $dout
cp -r  03.1.giggle_idx_00 $dout
cp 03.1.meta.ped.00 $dout
cp 03.1.stix_idx_00.db $dout
singularity /data/jake/stix-lr-grch38 
$ stix -t DEL -l $left -r $right -s 500 -c 5 \
>   -i 03.1.giggle_idx_00 -d 03.1.stix_idx_00.db
stix_run_giggle_query: left:1 10000 10379       right:1 10433 35120
Total   0:1     4:45    0:0:0   0:0:0:0
Giggle_File_Id  Sample  Sex     population      Super_population        Alt_File     Pairend  Split
0       GM18501.1000g.ont       1       NA      NA      GM18501.1000g.ont.sorted.bed.gz       0       5
1       GM18519.1000g.ont       1       NA      NA      GM18519.1000g.ont.sorted.bed.gz       0       4
2       GM18856.1000g.ont       1       NA      NA      GM18856.1000g.ont.sorted.bed.gz       0       2
3       GM18861.1000g.ont       1       NA      NA      GM18861.1000g.ont.sorted.bed.gz       0       8
```
- a copy of index works!
- try using sharding utility

```
left=1:10000-10379
right=1:10433-35120
stix -t DEL -l $left -r $right -s 500 -c 5 \
  -B /data/jake/tmp/z
# stix_run_giggle_query: left:1 10000 10379       right:1 10433 35120
# Total   0:1     4:45    0:0:0   0:0:0:0
# Giggle_File_Id  Sample  Sex     population      Super_population        Alt_File        Pairend Split
# 0       GM18501.1000g.ont       1       NA      NA      GM18501.1000g.ont.sorted.bed.gz 0       5
# 1       GM18519.1000g.ont       1       NA      NA      GM18519.1000g.ont.sorted.bed.gz 0       4
# 2       GM18856.1000g.ont       1       NA      NA      GM18856.1000g.ont.sorted.bed.gz 0       2
# 3       GM18861.1000g.ont       1       NA      NA      GM18861.1000g.ont.sorted.bed.gz 0       8
# 4       GM18864.1000g.ont       1       NA      NA      GM18864.1000g.ont.sorted.bed.gz 0       30
# 5       GM18865.1000g.ont       1       NA      NA      GM18865.1000g.ont.sorted.bed.gz 0       12
# 6       GM18871.1000g.ont       1       NA      NA      GM18871.1000g.ont.sorted.bed.gz 0       8
# 7       GM18876.1000g.ont       1       NA      NA      GM18876.1000g.ont.sorted.bed.gz 0       0
# 8       GM18924.1000g.ont       1       NA      NA      GM18924.1000g.ont.sorted.bed.gz 0       5
```
- ... 49 samples were returned
- try adding one more shard to see how output changes
```
# add shard 1
dout=/data/jake/stix-lr-grch38
cd /data/stix/LR/2024-09-05
cp -r 03.1.giggle_idx_01 $dout
cp 03.1.stix_idx_01.db $dout
cp 03.1.meta.ped.01 $dout
cp -r 02.1.data.01 $dout
printf "03.1.giggle_idx_01\t03.1.stix_idx_01.db\n" >> /data/jake/tmp/z
```

```
# query with 2 lines in shard file
left=1:10000-10379
right=1:10433-35120
stix -t DEL -l $left -r $right -s 500 -c 5 \
  -B /data/jake/tmp/z
```
- yes! this output had 49 + 50 samples

- start copying over all files to /data/jake/stix-lr-grch38
```
cd /data/stix/LR/2024-09-05
dout=/data/jake/stix-lr-grch38
ls | grep -v "^02.1.data$" | \
  gargs --log=$dout/copy.log -p 4 "cp -r {0} $dout"
```
- next, finally setup queries for COLO!
- make shardfile
```
ls | grep giggle_idx | sort > x
ls | grep "db$" | sort > y
paste x y > shardfile.txt
rm x y
```
- note: small stix shard test script at /data/jake/stix-lr-grch38/test.sh
approach for stix lr colo
- input: COLO VCF
  - do somatic first for faster testing
```
cd /data/jake/stix-lr-grch38
colo_somatic="/data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_benchmark_grch38.vcf"
outfile=/data/jake/stix-lr/results/2025_12-colo-stix_lr/colo_somatic.stix_lr.min_read_5.txt
stix -B shardfile.txt -s 500 -f $colo_somatic -T 5 > $outfile
```

- get pop freq and svid table
```
cd /data/jake/stix-lr/src
./stixlr_vcfout2svid_cample_count.py \
  --input ../results/2025_12-colo-stix_lr/colo_somatic.stix_lr.min_read_5.txt \
  --output ../results/2025_12-colo-stix_lr/colo_somatic.stix_lr.min_read_5.svid_sample_count.tsv \
  --add_header
```

- run colo somatic,germline with 5 and 1 min reads
```
cd /data/jake/stix-lr/src
stix_lr-colo.sh
```

## goal 2: hg002 stix lr
```
cd /data/jake/stix-lr/src
./stix_lr-hg002_cmrg.sh
```

## goal 3: hg002 svafotate
```
./svafotateout2svid_maxaf.py \
  --input ../data/2025_12-hg002-cmrg/HG002_GRCh38_difficult_medical_gene_SV_benchmark_v0.01_trusted_SVTYPE.addID.svafotate.vcf \
  --output ../results/2025_12-hg002_cmrg-svafotate/hg002_cmrg-svafotate-svid_maxpopfreq.tsv \
  --add_header
```
- done

## goal 4: hg002 svanna

```
input=../data/2025_12-hg002-cmrg/HG002_GRCh38_difficult_medical_gene_SV_benchmark_v0.01_trusted_SVTYPE.addID.svafotate.vcf
outdir=../results/2025_12-hg002_cmrg-svanna
$svanna prioritize \
  --vcf=$input \
  --output-format=tsv \
  --frequency-threshold=0.1 \
  --no-breakends \
  --out-dir=$outdir \
  --overlap-threshold=80 \
  --phenotype-term HP:0011890 # useless, but needed to run
```





## summary
- learned how to use -B and -f with stix
  - -B <shardfile> automatically combines stix queries across shards
  - -f <vcf> will search using a vcf as input
- started running stix lr with min_reads=1or5 for colo somatic/germline
- wrote stixlr_vcfout2svid_cample_count.py to get 
  - svid\tsample_count from stix lr output vcf
- ran hg002 stix lr

## next steps
- once stix lr colo is done, send updated tar to Ryan
- COSMCI
  - convert latest cosmic tsv -> vcf
  - run stixlr, svafotate, svanna on it
- HG002
  - run svafotate, try svanna again
    - let ov vary for svafotate









# 12-16-25
## goal 1: send svafotate colo data to ryan for plotting
- wants 2 arrays indexed by svs
  - array of positives (somatic)
  - array of negatives (germline)
  - elements are num. samples
    - right now, i have pop freq only, ..., but I can see if # samples makes sense
- get ^ for each overlap parameter

- ex svafotatefile
```
ex=/data/jake/stix-lr/results/2025_11-colo_svafotate/somatic/svafotate-overlap_0.5-source_all.vcf
```

Max_AF v Max_PopMax_AF
- summary: use Max_AF for global interpretation, use PopMax_AF for sub population interpretation
```
Why both fields exist (practical interpretation)
Use Max_AF when:
You care about global rarity.
You are filtering broadly common SVs.
You want a simple “how common is this overall?” metric.
Use Max_PopMax_AF when:
You want to avoid filtering out population-specific common variants.
You are doing rare disease analysis.
You want to be conservative about declaring something “rare.”
In clinical / rare-variant workflows, Max_PopMax_AF is usually the safer filter.
```
- luckily, current code already uses Max_AF

- let's try to track the SVID alongside Max_AF for ordering purposes
- approach:
  - input: svafotate vcf
  - ouput: 2-col tsv of SVID and Max_AF
```
# somatic
overlaps=("0.5" "0.6" "0.7" "0.8" "0.9")
for ov in "${overlaps[@]}"; do
  ./svafotateout2svid_maxaf.py \
    --input "../results/2025_11-colo_svafotate/somatic/svafotate-overlap_${ov}-source_all.vcf" \
    --output "../results/2025_11-colo_svafotate/somatic/svafotate-overlap_${ov}-source_all.maxpopfreq.txt" \
    --add_header
done
# germline
for ov in "${overlaps[@]}"; do
  ./svafotateout2svid_maxaf.py \
    --input "../results/2025_11-colo_svafotate/germline/svafotate-overlap_${ov}-source_all.vcf" \
    --output "../results/2025_11-colo_svafotate/germline/svafotate-overlap_${ov}-source_all.maxpopfreq.txt" \
    --add_header
done

# combine into tar archive
mkdir tmp && cd tmp
# somatic
cp /data/jake/stix-lr/results/2025_11-colo_svafotate/somatic/*maxpopfreq.txt .
ls | gargs "mv {0} somatic.{0}"
# germline
cp /data/jake/stix-lr/results/2025_11-colo_svafotate/germline/*.maxpopfreq.txt .
ls | grep -v somatic | gargs "mv {0} germline.{0}"
tar -czf colo_svafotate.tar.gz *.txt 
mv colo_svafotate.tar.gz ../
cd ../
rm -ri tmp

```



## goal 2: send current cosmic data to ryan for plotting
- get a quick svid\tsample count for stix lr cosmic for Ryan
```
cd /data/jake/stix-lr/results/2025_12-cosmic-stix_lr
out=cosmic-stix_lr.counts.tsv
printf "svid\tsample_count\n" > $out
tail -n +2 lr_cosmic_pop_freq_t_5_ps1104.bed | \
  awk -v OFS='\t' '{ print $4"."$1"."$2"."$3, $5 }' >> $out
- download this file and send to Ryan

## goal 3: start stix queries for colo
- revisit old stix sharded code


## goal 4: not a goal
- important note: the hg002 cmrg sent by ryan has INS and DEL with non-neg SVLEN ...
  - use this as a reference for COSMIC TSV -> VCF

## summary
- aggregated svafotate colo results and sent to ryan
  - colo_svafotate.tar.gz
- sent ryan cosmic data for plotting
  - /data/jake/stix-lr/results/2025_12-cosmic-stix_lr/cosmic-stix_lr.counts.tsv
- noticed that VCF should not have neg len, so adjust tsv -> vcf conversion for COSMIC
- wrote /data/jake/stix/src/stix.py
  - for searching

## next steps
- add shard support for stix_search.py
- add parallelization support for stix_search.py

# 12-15-25
## goal 1: get info on lr indices on mcclintock

### 2024-09-07 index
```
cd /data/stix/LR/2024-09-07
```
likely t2t reference
```
ls 02.1.data | head -n 3
# GM18501_chm13.1kgont.sorted.bed.gz
# GM18519_chm13.1kgont.sorted.bed.gz
# GM18856_chm13.1kgont.sorted.bed.gz
```

```
zcat HG04131.sorted.1kgvienna.t2t.bed.gz | cut -f1 | sort | uniq  | wc -l
# 25
```
25 contigs
```
ls *.gz | wc -l
# 1106
```
1106 samples

```
tail -n +2  03.1.meta.ped | cut -f1 | sort | uniq | wc -l
```

### 2024-09-05 index
```
cd /data/stix/LR/2024-09-05
```

```
ls 02.1.data | head -n 3
# GM18501.1000g.ont.sorted.bed.gz
# GM18519.1000g.ont.sorted.bed.gz
# GM18856.1000g.ont.sorted.bed.gz
```
- likely grch38 ref because no t2t in filename
```
zcat NA18516.vienna.sorted.bed.gz | cut -f 1 | sort | uniq | wc -l
# 133
```
133 contigs

```
ls *.gz | wc -l
# 1108
```
1108 samples

```
tail -n +2  03.1.meta.ped | cut -f1 | sort | uniq | wc -l
# 1108
```

## summary

- /data/stix/LR/2024-09-05
  - seems to be grch38 with 1108 samples
- /data/stix/LR/2024-09-07
  - seems to be t2t with 1106 samples


## next steps
- get stix COLO results using /data/stix/LR/2024-09-05 index
- add to roc plot
- add auc computation
- ... try injecting a cosmic sv into svafotate bed to see if tsv->vcf conversion is the issue




# 12-14-25
## goal 1: check if I can use previous results to get COSMIC SVs
- /data/jake/lr_stix_analysis/data/lr_cosmic_pop_freq_t_1.bed
```
f=/data/jake/lr_stix_analysis/data/lr_cosmic_pop_freq_t_1.bed
head $f
#6       83872968        83879084        DEL     177
#11      93136610        93142675        DEL     965
#4       90839757        90925609        DEL     17
#14      98317633        98318741        DEL     578
#13      103279292       103279599       DEL     852
#22      17577694        18060448        DEL     0
#3       144974259       144974385       DEL     907
#20      14722237        15115062        DEL     0
#8       78167094        78167165        DEL     186
```
- looks like counts for each COSMIC query SV
  - check the COSMIC SV TSV to see if some of these coordinates match
```
cosmic_slr=/data/jake/stix-lr/data/2025_12-cosmic_stix_lr/lr_cosmic_pop_freq_t_5.bed
cosmic_sv_tsv=/data/jake/stix-lr/data/2025_11-cosmic_sv/Cosmic_StructuralVariants_v103_GRCh38.tsv.gz
head $cosmic_slr
#6       83872968        83879084        DEL     12
#11      93136610        93142675        DEL     862
#4       90839757        90925609        DEL     2
#14      98317633        98318741        DEL     483
#13      103279292       103279599       DEL     771
#22      17577694        18060448        DEL     0
#3       144974259       144974385       DEL     836
#20      14722237        15115062        DEL     0
#8       78167094        78167165        DEL     157
#8       6933342 6933659 DEL     1028
zcat $cosmic_sv_tsv | awk '$10=="6" && $12=="83872968" && $13="83879084"'
#8012347 COSS1842438 COSO29005278 COST120847 intrachromosomal deletion chr6:g.(83872968_83872988)_(83879084_83879104)del COSU328 351663 6 6 83872968 83879084 83879084 83879104 + +
#8012346 COSS1842436 COSO29005278 COST120847 intrachromosomal deletion chr6:g.(83872968_83872988)_(83879084_83879104)del COSU328 351663 6 6 83872968 83879084 83879084 83879104 + +
zcat $cosmic_sv_tsv | awk '$10=="11" && $12=="93136610" && $13="93136610"'
#8012346 COSS1842436 COSO29005278 COST120851 intrachromosomal deletion chr11:g.(93136610_93136630)_(93142675_93142695)del COSU328 351667 11 11 93136610 93136610 93142675 93142695 + +
#8012347 COSS1842438 COSO29005278 COST120851 intrachromosomal deletion chr11:g.(93136610_93136630)_(93142675_93142695)del COSU328 351667 11 11 93136610 93136610 93142675 93142695 + +
```
- seems reasonable for now, will double check w/ Ryan and Murad
- still need num samples in STIX-lr index
  - check if stix-lr is on mcclintock and see if it matches num samples in publication
```
# launch singularity
cd ~/sv && ./run.sh
dstixlr=/data/stix/LR/2024-09-07
tmp=/data/jake/tmp
cd $dstixlr
ls | grep giggle > $tmp/stix_lr_indices.txt
mapfile -t indices < $tmp/stix_lr_indices.txt
# count samples
n=0
for idx in "${indices[@]}"; do
  x=$(giggle search -i $idx -l | wc -l)
  # minus 1 for a header line
  x=$((x-1))
  n=$((n + x))
done
echo $n
#1104
```

```
# see if max sample count reveals pop sizes
cut -f 5 lr_cosmic_pop_freq_t_1.bed \
  | sort -n | uniq | tail
# 1088
# 1089
# 1090
# 1091
# 1092
# 1093
# 1094
# 1095
# 1096
# 1097
```

- summary so far
  - data file (/data/jake/stix-lr/data/2025_12-cosmic_stix_lr/lr_cosmic_pop_freq_t_5.bed) 
  seems to be for COSMIC SVs
  - Either 1104 (mcclintock) or 1108 (manuscript) samples in stix-lr
- next ...
  - get pop freq for stix lr 5 reads for all cosmic SVs
  - use stix lr data file to create a vcf of cosmic for svafotate
  - get pop freq in svafotate for cosmic svs
  - plot cumulative sv count versus pop freq for stix and svafotate

```
# stix lr cosmic pop freq (5 supp reads)

./stix_lr_cosmic2pop_freq.py \
  --input ../data/2025_12-cosmic_stix_lr/lr_cosmic_pop_freq_t_5.bed \
  --output ../results/2025_12-cosmic-stix_lr/lr_cosmic_pop_freq_t_5_ps1104.bed \
  --pop_size 1104
```
- making a vcf for svafotate from stix lr cosmic file
  - what are the headers in the colo vcf? use this as a reference to convert
```
grep "^#" colo829_benchmark_grch38.vcf
##fileformat=VCFv4.2
##contig=<ID=chr1,length=248956422>
##contig=<ID=chr2,length=242193529>
##contig=<ID=chr3,length=198295559>
##contig=<ID=chr4,length=190214555>
##contig=<ID=chr5,length=181538259>
##contig=<ID=chr6,length=170805979>
##contig=<ID=chr7,length=159345973>
##contig=<ID=chr8,length=145138636>
##contig=<ID=chr9,length=138394717>
##contig=<ID=chr10,length=133797422>
##contig=<ID=chr11,length=135086622>
##contig=<ID=chr12,length=133275309>
##contig=<ID=chr13,length=114364328>
##contig=<ID=chr14,length=107043718>
##contig=<ID=chr15,length=101991189>
##contig=<ID=chr16,length=90338345>
##contig=<ID=chr17,length=83257441>
##contig=<ID=chr18,length=80373285>
##contig=<ID=chr19,length=58617616>
##contig=<ID=chr20,length=64444167>
##contig=<ID=chr21,length=46709983>
##contig=<ID=chr22,length=50818468>
##contig=<ID=chrX,length=156040895>
##contig=<ID=chrY,length=57227415>
##ALT=<ID=INS,Description="Insertion">
##ALT=<ID=DEL,Description="Deletion">
##ALT=<ID=DUP,Description="Duplication">
##ALT=<ID=INV,Description="Inversion">
##ALT=<ID=BND,Description="Breakend; Translocation">
##INFO=<ID=SVTYPE,Number=1,Type=String,Description="Type of structural variation">
##INFO=<ID=SVLEN,Number=1,Type=Integer,Description="Length of structural variation">
##INFO=<ID=END,Number=1,Type=String,Description="End position of structural variation">
##INFO=<ID=CHR2,Number=1,Type=String,Description="Mate chromsome for BND SVs">
##INFO=<ID=SUPPORT,Number=1,Type=String,Description="Sample support with Sample_name_program|GT|VAF for four COLO829 replicates">
##FILTER=<ID=PASS,Description="All filters passed">
##FORMAT=<ID=GT,Number=1,Type=String,Description="Genotype">
#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT  COLO829SV
```
- contigs are chromosomes and their length
- ALT are types of SVs
- INFO
  - SVTYPE
  - SVLEN
  - END
  - CHR2: mate chr for BNDs
  - SUPPORT: sample name, genotype, variant allele freq
  - FILTER: filters passed
  - GT: genotype

```
# check which SV types are in the COSMIC stix lr file
cut -f 4 lr_cosmic_pop_freq_t_5.bed | sort | uniq -c
# 46755 DEL
```
- only deletions in previous analysis
- Q: should the analysis only consider DELs?
- how many DELs are in COSMIC file?
```
zcat Cosmic_StructuralVariants_v103_GRCh38.tsv.gz \
  | grep -c deletion
# 56913
```
- okay, 56913 >> 46755, so I should probably just re-do 
the stix lr cosmic analysis (unfortunately)

## goal 2: use stix lr cosmic file to make a dummy vcf for svafotate
- fields,headers to spoof
  - headers (from colo somatic vcf)
```
##fileformat=VCFv4.2
##contig=<ID=chr1,length=248956422>
##contig=<ID=chr2,length=242193529>
##contig=<ID=chr3,length=198295559>
##contig=<ID=chr4,length=190214555>
##contig=<ID=chr5,length=181538259>
##contig=<ID=chr6,length=170805979>
##contig=<ID=chr7,length=159345973>
##contig=<ID=chr8,length=145138636>
##contig=<ID=chr9,length=138394717>
##contig=<ID=chr10,length=133797422>
##contig=<ID=chr11,length=135086622>
##contig=<ID=chr12,length=133275309>
##contig=<ID=chr13,length=114364328>
##contig=<ID=chr14,length=107043718>
##contig=<ID=chr15,length=101991189>
##contig=<ID=chr16,length=90338345>
##contig=<ID=chr17,length=83257441>
##contig=<ID=chr18,length=80373285>
##contig=<ID=chr19,length=58617616>
##contig=<ID=chr20,length=64444167>
##contig=<ID=chr21,length=46709983>
##contig=<ID=chr22,length=50818468>
##contig=<ID=chrX,length=156040895>
##contig=<ID=chrY,length=57227415>
##ALT=<ID=INS,Description="Insertion">
##ALT=<ID=DEL,Description="Deletion">
##ALT=<ID=DUP,Description="Duplication">
##ALT=<ID=INV,Description="Inversion">
##ALT=<ID=BND,Description="Breakend; Translocation">
##INFO=<ID=SVTYPE,Number=1,Type=String,Description="Type of structural variation">
##INFO=<ID=SVLEN,Number=1,Type=Integer,Description="Length of structural variation">
##INFO=<ID=END,Number=1,Type=String,Description="End position of structural variation">
##INFO=<ID=CHR2,Number=1,Type=String,Description="Mate chromsome for BND SVs">
```
  - fields 
#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT
  - ex row:
  chr1    207807886       COLO829_SOMATIC_SV1_DEL N       <DEL>   .       PASS    SVTYPE=DEL;SVLEN=-33588;END=207841474;CHR2=chr1;AF=0.311;SUPPORT=cutesv_colo829_gsc_lifted|0/1|0.297,cutesv_colo829_ont_lifted|0/1|0.357,cutesv_colo829_pbr_lifted|0/1|0.279,cutesv_colo829_vai_lifted|0/1|0.31,nmsv_tumor_gsc_lifted|0/1|0.297,nmsv_tumor_ont_lifted|0/1|0.357,nmsv_tumor_pbr_lifted|0/1|0.279,nmsv_tumor_vai_lifted|0/1|0.31,serv_colo829_gsc_lifted|0/1|0.297,serv_colo829_ont_lifted|0/1|0.357,serv_colo829_pbr_lifted|0/1|0.279,serv_colo829_vai_lifted|0/1|0.31,snf2_colo829_gsc_lifted|0/1|0.297,snf2_colo829_ont_lifted|0/1|0.357,snf2_colo829_pbr_lifted|0/1|0.279,snf2_colo829_vai_lifted|0/1|0.31  GT       0/1
  - I think we can fill missing data with '.'
    - missing/unneeded columns
      - QUAL, FILTER, FORMAT, ALT
    - for INFO 
      SVTYPE=DEL;SVLEN=END-POS;END=?;CHR2=#CHROM
  
- stix lr cosmic results to vcf for svafotate query
```
./stix_lr_cosmic2vcf.py \
  --input ../data/2025_12-cosmic_stix_lr/lr_cosmic_pop_freq_t_5.bed \
  --output ../results/2025_12-cosmic-stix_lr/cosmic_old_version.vcf
# sort
bcftools sort ../results/2025_12-cosmic-stix_lr/cosmic_old_version.vcf \
  -o ../results/2025_12-cosmic-stix_lr/cosmic_old_version_sort.vcf
# Writing to /tmp/bcftools.FIZiwS
# [W::vcf_parse_info] INFO/END=91571704 is smaller than POS at 2:91751052
# Merging 1 temporary files
# Done
# Cleaning
```

- validate vcf
```
vcf_validator -i ../results/2025_12-cosmic-stix_lr/cosmic_old_version_sort.vcf
# [info] Reading from input file...
# Lines read: 10000
# Lines read: 20000
# Lines read: 30000
# Lines read: 40000
# [info] Summary report written to : ../results/2025_12-cosmic-stix_lr/cosmic_old_version_sort.vcf.errors_summary.1765742002270.txt
# [info] According to the VCF specification, the input file is valid
```

- try running svafotate with the curated cosmic del/ins vcf
```
vcf=../results/2025_12-cosmic-stix_lr/cosmic_old_version_sort.vcf
bedfile=../data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz
overlap=0.9
conda activate svafotate-env
svafotate annotate -v $vcf -b $bedfile -f $overlap -O vcf \
  -o "../results/2025_12-cosmic-svafotate/cosmic_svafotate_ov${overlap}_rerun.vcf"
```

```
vcf=../results/2025_12-cosmic-stix_lr/cosmic_old_version_sort.vcf
bedfile=../data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz
overlap=0.5
conda activate svafotate-env
svafotate annotate -v $vcf -b $bedfile -f $overlap -O vcf \
  -o "../results/2025_12-cosmic-svafotate/cosmic_svafotate_ov${overlap}.vcf"
```

- try svafotate with 0.5 overlap

- handling sex chromosomes
  - cosmic uses x,y
  - stix lr uses 23,24
  - svafotate uses x,y
therefore, my stix2vcf script must map 23,24 -> x,y

## goal 3: plot stix LR COSMIC cumulative count versus SV

```
cd /data/jake/stix-lr/src
./plot_cosmic_stix_lr.py \
  --input_stix_lr ../results/2025_12-cosmic-stix_lr/lr_cosmic_pop_freq_t_5_ps1104.bed \
  --input_svafotate ../results/2025_12-cosmic-svafotate/cosmic_svafotate_ov0.9_rerun.vcf \
  --output_dir ../results/2025_12-cosmic-stix_lr
```
- add svafotate cosmic results
- re-use old code to parse max pop freq

## summary
- inspected previous stix lr cosmic results 
  - lr_stix_analysis/data/lr_cosmic_pop_freq_t_5.bed
    - used this (chr,start,end,type) to create a VCF of COSMIC fusions
      - stix_lr_cosmic2vcf.py
      - the vcf was formatted to match the COLO VCF i used with SVAFotate
        - INS seems to be problematic ... END < start/POS
        - however, i validated the format using vcf_validator tool
    - extracted pop freq
      - stix_lr_cosmic2pop_freq.py
- plotted cumulative cosmic sv count v pop freq for stix lr and svafotate overlap=0.9
  - problem: unsure if svafotate results are correct due to vcf formatting
- found that latest COSMIC SV table has more DELs than the analysis done in stix lr

## next steps
- write a slack progress report to Ryan and Murad
- add stix lr to colo benchmark
  - confirm which stix lr index I should use
- test out tsv -> vcf using entries that are clearly in svafotate bed
  - this will tell me whether my vcf format is the issue or not
  - ... update cosmic experiment results accordingly
    

# 12-12-25
## goal 1: verify that svanna vcf and tsv formats also don't include pop freq of SVs

```
# vcf
cd /data/jake/svanna/svanna-cli-1.2.0
$svanna prioritize \
  --vcf /data/jake/svanna/svanna-cli-1.2.0/examples/example.vcf \
  --phenotype-term HP:0011890 \
  --phenotype-term HP:0000978 \
  --phenotype-term HP:0012147 \
  --out-dir results \
  --prefix example \
  --output-format vcf \
  --uncompressed-output
# tsv
$svanna prioritize \
  --vcf /data/jake/svanna/svanna-cli-1.2.0/examples/example.vcf \
  --phenotype-term HP:0011890 \
  --phenotype-term HP:0000978 \
  --phenotype-term HP:0012147 \
  --out-dir results \
  --prefix example \
  --output-format tsv \
  --uncompressed-output
```

## goal2: plot colo svafotate as classification task
- horizontal axis: 
  - fp/n = germlin <= pop. freq / num. germline
- vertical axis:
  - tp/p = somatic <= pop.freq / somatic <= pop.freq + somatic > pop. freq
- approach
  - for each overlap param
    - for germline svs
      - for somatic svs
        - get each sv's pop freq
    - ^get a tbl with
    somatic/germline | pop. freq
    s | 0
    s | 0
    ...
    s | 0.1
    g | 0.2
    - threshold over pop. freq and compute
      - fp / germline (fpr) and tp / p (tpr)
    
```
./plot_colo_roc_like.py \
  --dirgermline ../results/2025_11-colo_svafotate/germline \
  --dirsomatic ../results/2025_11-colo_svafotate/somatic \
  --output_dir ../results/2025_11-colo_svafotate/ \
  --file_pattern source_all \
  --cache
```
    


# 12-11-25
## goal1:
- get pop freq for COLO from SvAnna
- so, there's only a binary db file
  - maybe H2 database
- may be easier to just get the VCFs used and see if they have a max AF pop freq
  - gnomAD: https://ftp.ncbi.nlm.nih.gov/pub/dbVar/data/Homo_sapiens/by_study/genotype/nstd166/gnomad_v2.1_sv.sites.vcf.gz
    - yes: ##INFO=<ID=POPMAX_AF
  - HGSVC: http://ftp.1000genomes.ebi.ac.uk/vol1/ftp/data_collections/HGSVC2/release/v1.0/integrated_callset/freeze3.sv.alt.vcf.gz
    - no INFO on allele freq
  - dbSNP
    - ##INFO=<ID=G5,Number=0,Type=Flag,Description=">5% minor allele frequency in 1+ populations">
    - ##INFO=<ID=G5A,Number=0,Type=Flag,Description=">5% minor allele frequency in each and all populations">
    - ##INFO=<ID=CAF,Number=.,Type=String,Description="An ordered, comma delimited list of allele frequencies based on 1000Genomes, starting with the reference allele followed by alternate alleles as ordered in the ALT column. Where a 1000Genomes alternate allele is not in the dbSNPs alternate allele set, the allele is added to the ALT column. The minor allele is the second largest value in the list, and was previuosly reported in VCF as the GMAF. This is the GMAF reported on the RefSNP and EntrezSNP pages and VariationReporter">
    - ##INFO=<ID=COMMON,Number=1,Type=Integer,Description="RS is a common SNP.  A common SNP is one that has at least one 1000Genomes population with a minor allele of frequency >= 1% and for which 2 or more founders contribute to that minor allele frequency.">
    - SV sizes range from 1-49
    - they probably check the COMMON field for filtering
  - DGV
    - https://dgv.tcag.ca/dgv/docs/GRCh38_hg38_variants_2020-02-25.txt
    - frequency
      - column 14, ... it's completely empty
      ```
      awk -v OFS='\t' "{ print  }" DGV.GRCh38_hg38_variants_2020-02-25.txt > dgv.cln
      cut -f 13-15 dgv.cln
      ```
    - try supporting variants file instead
      - https://dgv.tcag.ca/dgv/docs/GRCh38_hg38_supportingvariants_2020-02-25.txt
      - some, not most have frequency
so, in summary
- pop freq in avail in DGV (tsv) and gnomAD (vcf)
- dbSNP has a common alleles (but these are SNPs can probably ignore)
- a simple approach may be to just add DGV to SVAFotate BED
  - SVAFotate bed already has ThousG and gnomAD
  - dbSNP is SNPs not SVs

try running SvAnna, and see if pop freq is easy to get from output
... installing java 17
wget 'https://download.oracle.com/java/17/archive/jdk-17.0.12_linux-x64_bin.tar.gz'
- downloaded the svanna data file to 
  - /data/jake/svanna/svanna-cli-1.2.0/data
```
cd /data/jake/svanna/svanna-cli-1.2.0/data
wget 'https://zenodo.org/records/17749179/files/2511_hg38.svanna.zip'

```

- trial run
```
cd /data/jake/svanna/svanna-cli-1.2.0
# have to setup phenotype stuff first
# takes about 5 min
$svanna setup-phenotype -d /data/jake/svanna/svanna-cli-1.2.0/data
# 
$svanna prioritize \
  --vcf /data/jake/svanna/svanna-cli-1.2.0/examples/example.vcf \
  --phenotype-term HP:0011890 \
  --phenotype-term HP:0000978 \
  --phenotype-term HP:0012147 \
  --out-dir results \
  --prefix example
```

## summary
- inspected the variant DBs that SvAnna uses for filtering
  - high overlap with SVAFotate DBs
- simplest approach is just to add the DGV pop freqs to SVAFotate bed file
  - then run SVAFotate
- ran SvAnna
  - results say nothing about pop freq.

# 12-2-25
## goal1: run SVAFotate with all sources on colo germine and somatic

- edited exp_svafotate_colo_somatic.py for
  - cache check
  - all source run

```
# germline
./exp_svafotate_colo_somatic.py \
  --input ../data/2025_11-colo_sv_calls/colo829_merge_grch38.vcf \
  --bed ../data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz \
  --outdir ../results/2025_11-colo_svafotate/germline \
  --scriptdir /data/jake/stix-lr/src \
  --cpus 1 \
  --cache \
  --env_name svafotate-env 2>&1 | tee ../log/2025_12_3-exp_svafotate_colo_germline.log

# somatic
./exp_svafotate_colo_somatic.py \
  --input ../data/2025_11-colo_sv_calls/colo829_benchmark_grch38.vcf \
  --bed ../data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz \
  --outdir ../results/2025_11-colo_svafotate/somatic \
  --scriptdir /data/jake/stix-lr/src \
  --cpus 1 \
  --cache \
  --env_name svafotate-env 2>&1 | tee ../log/2025_12_3-exp_svafotate_colo_somatic.log

# plot
./plot_colo_svafotate.py \
  --dirgermline ../results/2025_11-colo_svafotate/germline \
  --dirsomatic ../results/2025_11-colo_svafotate/somatic \
  --output ../results/2025_11-colo_svafotate/colo_svafotate_bar2.png

# 11-25-25
## goal1 : run SVAFotate on colo germline
```
./exp_svafotate_colo_somatic.py \
  --input ../data/2025_11-colo_sv_calls/colo829_merge_grch38.vcf \
  --bed ../data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz \
  --outdir ../results/2025_11-colo_svafotate/germline \
  --scriptdir /data/jake/stix-lr/src \
  --cpus 1 \
  --env_name svafotate-env 2>&1 | tee ../log/exp_svafotate_colo_germline.log
```
## goal2: barplot viz
- horizontal axis: bins of AF {0, (0,1%], (1%,5%], (5%,100%]}
- vertical axis: sv count
- color: somatic (blue), germline + somatic (purple)

```
cd /data/jake/stix-lr/src
./plot_colo_svafotate.py \
  --dirgermline ../results/2025_11-colo_svafotate/germline \
  --dirsomatic ../results/2025_11-colo_svafotate/somatic \
  --output ../results/2025_11-colo_svafotate/colo_svafotate_bar.png
```

## summary
- ran SVAFotate on COLO germline
- plotted SVAFotate germline/somatic results
  - /data/jake/stix-lr/results/2025_11-colo_svafotate/colo_svafotate_bar.png

## next steps
- SVanna for COLO
- SVAFotate for COSMIC
  - requires TSV -> VCF

# 11-24-25
## goal: run SVAFotate on COLO
- data
    - SVAFotate BED
        - /data/jake/stix-lr/data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz
    - COLO somatic cancer and normal VCF
        - somatic /data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_benchmark_grch38.vcf
        - normal /data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_merge_grch38.vcf.gz
- approach
    - use minimum of overlap >=50% (-f 0.5)
    - let -f vary from 0.5, 0.6, ..., 0.9
- experiment
    - stratifications
        - min overlap (dim 5)
        - SVAFotate sources (dim 4)
        - 20 total
        ```
        zcat $SVAFTOTATE_BED | tail -n +2 | cut -f 6 | sort | uniq 
        CCDG
        gnomAD
        ThousG
        TOPMed
        ```
    - run SVAFotate for each stratified bed and with variable -f 

- test example SVAFotate
    - thousG only and colo somatic vcf
    ```
    vcf=/data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_benchmark_grch38.vcf
    bed=/data/jake/stix-lr/data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz
    conda activate svafotate-env
    time (svafotate annotate -f 0.9 -v $vcf -s ThousG -O vcf -b $bed -o colo829_somatic_svafotate_thousg.vcf)

    ```
error:
Annotating with the following sources and reciprocal overlap fractions:
Traceback (most recent call last):
  File "/data/jake/miniconda3/envs/svafotate-env/bin/svafotate", line 8, in <module>
    sys.exit(main())
  File "/data/jake/miniconda3/envs/svafotate-env/lib/python3.8/site-packages/svafotate/__main__.py", line 41, in main
    args.func(parser, args)
  File "/data/jake/miniconda3/envs/svafotate-env/lib/python3.8/site-packages/svafotate/svafotate_main.py", line 517, in annotate
    raise NameError(str(s) + " is an unexpected source; acceptable sources include (case-sensitive): " + ",".join(sorted(sources)))
NameError: "ThousG" is an unexpected source; acceptable sources include (case-sensitive): CCDG,TOPMed,ThousG,gnomAD
error 2
(svafotate-env) [jakr3437@mcclintock 2025_11-svafotate_bed_by_source]$ time (svafotate annotate -f 0.9 -v $vcf -s ThousG -O vcf -b $bed -o colo829_somatic_svafotate_thousg.vcf)

Annotating the following VCF: /data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_benchmark_grch38.vcf

Reading the following data source file: /data/jake/stix-lr/data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz

Annotating with the following sources and reciprocal overlap fractions:
ThousG  0.9

Gathering SV coordinates from VCF file: /data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_benchmark_grch38.vcf
[W::vcf_parse_info] INFO 'AF' is not defined in the header, assuming Type=String
Traceback (most recent call last):
  File "/data/jake/miniconda3/envs/svafotate-env/bin/svafotate", line 8, in <module>
    sys.exit(main())
  File "/data/jake/miniconda3/envs/svafotate-env/lib/python3.8/site-packages/svafotate/__main__.py", line 41, in main
    args.func(parser, args)
  File "/data/jake/miniconda3/envs/svafotate-env/lib/python3.8/site-packages/svafotate/svafotate_main.py", line 627, in annotate
    end = int(v.INFO.get("END")) if v.INFO.get("END") is not None else int(v.POS)
ValueError: invalid literal for int() with base 10: 'N[chr15:84141972['


real    2m49.816s
user    2m38.740s
sys     0m12.728s


attempt 3
vcf=/data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_benchmark_grch38_no_bnd.vcf
bed=/data/jake/stix-lr/data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz
time (svafotate annotate -f 0.9 -v $vcf -s ThousG -O vcf -b $bed -o colo829_somatic_svafotate_thousg.vcf)
error 3
time (svafotate annotate -f 0.9 -v $vcf -s ThousG -O vcf -b $bed -o colo829_somatic_svafotate_thousg.vcf)

Annotating the following VCF: /data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_benchmark_grch38_no_bnd.vcf

Reading the following data source file: /data/jake/stix-lr/data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz

Annotating with the following sources and reciprocal overlap fractions:
ThousG  0.9

Gathering SV coordinates from VCF file: /data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_benchmark_grch38_no_bnd.vcf
[W::vcf_parse_info] INFO 'AF' is not defined in the header, assuming Type=String

Creating pyranges object from VCF data...

Running pyranges.join for:
ThousG

Creating pyranges objects per SVTYPE from VCF data...

Adding annotations to output VCF...
[W::vcf_parse_info] INFO 'AF' is not defined in the header, assuming Type=String
Traceback (most recent call last):
  File "/data/jake/miniconda3/envs/svafotate-env/bin/svafotate", line 8, in <module>
    sys.exit(main())
  File "/data/jake/miniconda3/envs/svafotate-env/lib/python3.8/site-packages/svafotate/__main__.py", line 41, in main
    args.func(parser, args)
  File "/data/jake/miniconda3/envs/svafotate-env/lib/python3.8/site-packages/svafotate/svafotate_main.py", line 1403, in annotate
    new_vcf.write_record(v)
  File "cyvcf2/cyvcf2.pyx", line 2371, in cyvcf2.cyvcf2.Writer.write_record
Exception: variant to be written has errorcode: 2

attempt 4
vcf=/data/jake/stix-lr/data/2025_11-colo_sv_calls/colo829_benchmark_grch38_fixed.vcf
bed=/data/jake/stix-lr/data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz
time (svafotate annotate -f 0.9 -v $vcf -s ThousG -O vcf -b $bed -o colo829_somatic_svafotate_thousg.vcf)
#! successful

- clearly documenting the VCF cleanup required for SVAFOTATE
1.  BND filter
  - breakends (BNDs) were filtered from query VCF
  because the END encoding was strange (e.g., SVTYPE=BND;SVLEN=NA;END=N[chr19:17286830[;CHR2=chr19;SUPPORT=snf2_colo829_gsc_lifted)
    - SVAFOTATE expected an integer
2. Add an AF INFO field definition to VCF header
3. Change END type from String -> Integer

```
# gpt code for adding AF INFO header
# first line fixes the END type
# second line, find where CHR2 info header line is
# third line append the AF info header line after the CHR2 line
cd /data/jake/stix-lr/data/2025_11-colo_sv_calls && cat > fix_vcf_header.sed << 'EOF'
s/^##INFO=<ID=END,Number=1,Type=String,Description="End position of structural variation">$/##INFO=<ID=END,Number=1,Type=Integer,Description="End position of structural variation">/
/^##INFO=<ID=CHR2,Number=1,Type=String,Description="Mate chromsome for BND SVs">$/a\
##INFO=<ID=AF,Number=1,Type=Float,Description="Allele frequency">
EOF
```

- so, to do this all programatically
1. filter out BNDs
bcftools view --exclude 'INFO/SVTYPE="BND"' input.vcf > output.vcf
2. Set END type to integer and add AF header line
- see scr/setup_vcf.sed

- testing out querying svafotated vcf for source
  - ah, well AF is only reported as a MAX, so it's probably
  easiest to just run multiple times with diff -s
  - example code to get Max_AF for all lines
  ```
  # each max_af gets its own line
  bcftools query -f '%INFO/Max_AF\n' colo829_somatic_svafotate_all.vcf
  ```

- wrapper script for colo vcf svafotate experiment
  - inputs:
    - i) colo somatic vcf
    - ii) svafotate bed
  - outputs:
    - a vcf for each (overlap_thresh, source)
    - a text file for each vcf with line delimited max_af per variant

```
./exp_svafotate_colo_somatic.py \
  --input ../data/2025_11-colo_sv_calls/colo829_benchmark_grch38.vcf \
  --bed ../data/2025_11-svafotate_bed/SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz \
  --outdir ../results/2025_11-colo_svafotate \
  --scriptdir /data/jake/stix-lr/src \
  --cpus 1 \
  --env_name svafotate-env 2>&1 | tee ../log/exp_svafotate_colo_somatic.log
```


## summary
- src/split_svafotate_bed_by_source stratified the SVAFOTATE BED by dataset (source)
    - waste of time, just use -s instead
- wrote script to clean colo vcf
  - setup_colo_vcf.sh
  - have start code for running SVAFotate on colo VCFs
    - /data/jake/stix-lr/results/2025_11-colo_svafotate/run.sh

## next steps
- plot results for somatic colo VCFs
  - do a histogram or binned barplot (like manuscript)
- try experiment on germline VCF, ..., see how long it will take
    

# 11-20-25
## goal 1: confirm using only 1kg samples for somatic cancer sv experiments

- num rows in SVAFotate bed
```
zcat SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz | wc -l
# 3455240
```
- SV counts by project
```
zcat SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz | tail -n +2 | cut -f6 | sort | uniq -c
# 754213 CCDG
# 2154486 gnomAD
# 170242 ThousG
# 376298 TOPMed
```
- there is not column that indicates which samples have the SV

- example row of SVAFotate bed for 1kg
(base) [jakr3437@mcclintock 2025_11-svafotate_bed]$ zcat SVAFotate_core_SV_popAFs.GRCh38.v4.1.bed.gz | grep ThousG | head -n 1
1       27999   140000  112000  CNV     ThousG  HGSV_1  0.241208001971  1560    1454    0       0.238973006606  793     726     0       NA      NA      0.243478000164  767     728     0       0.291716009378 352      493     0       0.29587200284   178     258     0       NA      NA      0.287286013365  174     235     0       NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA     NA       NA      NA      0.214285999537  268     201     0       0.206976994872  126     89      0       NA      NA      0.220471993089  142     112     0       NA      NA      NA      NA      NA      NA     NA       NA      NA      NA      NA      NA      NA      NA      0.284350991249  226     298     0       0.290565997362  111     154     0       NA      NA      0.277992010117  115     144     0       0.208263993263  353     252     0       0.196245998144  178     115     0       NA      NA      0.219550997019  175     137     0       NA      NA      NA      NA      NA      NA      NA      NA      NA      NA     NA       NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA     NA       NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      NA      0.18388800323   361     210     0       0.177419006824  200     110     0       NA      NA      0.191570997238  161     100     0       0.291716009378 

- counting number of variants in for colo829_merge_grch38.vcf.gz
```
# probably germline SVs?
zcat colo829_merge_grch38.vcf.gz | grep -v "^#" | wc -l
# 30526
# somatic svs
grep -v "^#" colo829_benchmark_grch38.vcf  |wc -l
# 54
# maybe I need to keep only INS|DEL|INV|DUP?
grep -v "^#" colo829_benchmark_grch38.vcf  | grep -E "INS|DEL|INV|DUP" | wc -l
# 50
# try removing BND
zcat colo829_merge_grch38.vcf.gz | grep -v "^#" | grep -E "INS|DEL|INV|DUP" | wc -l
# 30301
grep -v "^#" colo829_benchmark_grch38.vcf  | grep -v "BND" | wc -l
# 50
zcat colo829_merge_grch38.vcf.gz | grep -v "^#" | grep -v "BND" | wc -l
```

## summary
- found COLO sv callset on zenodo
    - unsure why counts are a bit off for SVs
- downloaded cosmic svs
    - but its in a gzipped tsv, not a vcf ...
